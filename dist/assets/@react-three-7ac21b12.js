import{_ as pe}from"./@babel-34ca84e8.js";import{r as g}from"./react-ba0062d6.js";import{T as Le,R as jt,O as We,P as $e,a as Me,L as Ce,b as Rt,c as kt,U as At,s as rt,B as Dt,M as Lt,V as q,d as Ft,S as zt,C as It,W as Ht,e as Wt,f as $t,g as Bt,h as Nt,i as Gt,N as qt,A as Ut,j as Vt,D as Xt,k as ge,l as Be,m as Yt,E as ot,n as Zt,o as Kt,p as Jt,q as Qt}from"./three-f07200c4.js";import{u as en}from"./react-use-measure-5538365e.js";import{F as tn,u as nn}from"./its-fine-53b8726a.js";import{R as rn,c as se}from"./react-reconciler-db32c92b.js";import{c as on}from"./react-dom-b352295a.js";import{c as it}from"./zustand-96d19ac0.js";import"./maath-ccdcc33f.js";import"./@react-spring-7eb7369e.js";import"./lodash.pick-4ed993c7.js";import{D as sn,G as Ne,a as an,M as xe,O as ln}from"./three-stdlib-2d5f3335.js";import"./lodash.omit-4ed993c7.js";import"./stats.js-4ed993c7.js";import{m as cn}from"./react-merge-refs-239dbb3c.js";import"./react-composer-7eb7369e.js";import{s as un,p as fn,c as dn}from"./suspend-react-00b64780.js";var _e={},pn={get exports(){return _e},set exports(e){_e=e}},st={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(y,E){var x=y.length;y.push(E);e:for(;0<x;){var O=x-1>>>1,A=y[O];if(0<s(A,E))y[O]=E,y[x]=A,x=O;else break e}}function n(y){return y.length===0?null:y[0]}function i(y){if(y.length===0)return null;var E=y[0],x=y.pop();if(x!==E){y[0]=x;e:for(var O=0,A=y.length,F=A>>>1;O<F;){var W=2*(O+1)-1,V=y[W],X=W+1,te=y[X];if(0>s(V,x))X<A&&0>s(te,V)?(y[O]=te,y[X]=x,O=X):(y[O]=V,y[W]=x,O=W);else if(X<A&&0>s(te,x))y[O]=te,y[X]=x,O=X;else break e}}return E}function s(y,E){var x=y.sortIndex-E.sortIndex;return x!==0?x:y.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var h=Date,v=h.now();e.unstable_now=function(){return h.now()-v}}var a=[],m=[],r=1,o=null,c=3,d=!1,p=!1,P=!1,w=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(y){for(var E=n(m);E!==null;){if(E.callback===null)i(m);else if(E.startTime<=y)i(m),E.sortIndex=E.expirationTime,t(a,E);else break;E=n(m)}}function _(y){if(P=!1,b(y),!p)if(n(a)!==null)p=!0,G(M);else{var E=n(m);E!==null&&D(_,E.startTime-y)}}function M(y,E){p=!1,P&&(P=!1,l(k),k=-1),d=!0;var x=c;try{for(b(E),o=n(a);o!==null&&(!(o.expirationTime>E)||y&&!j());){var O=o.callback;if(typeof O=="function"){o.callback=null,c=o.priorityLevel;var A=O(o.expirationTime<=E);E=e.unstable_now(),typeof A=="function"?o.callback=A:o===n(a)&&i(a),b(E)}else i(a);o=n(a)}if(o!==null)var F=!0;else{var W=n(m);W!==null&&D(_,W.startTime-E),F=!1}return F}finally{o=null,c=x,d=!1}}var S=!1,R=null,k=-1,C=5,T=-1;function j(){return!(e.unstable_now()-T<C)}function H(){if(R!==null){var y=e.unstable_now();T=y;var E=!0;try{E=R(!0,y)}finally{E?N():(S=!1,R=null)}}else S=!1}var N;if(typeof f=="function")N=function(){f(H)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,I=U.port2;U.port1.onmessage=H,N=function(){I.postMessage(null)}}else N=function(){w(H,0)};function G(y){R=y,S||(S=!0,N())}function D(y,E){k=w(function(){y(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(y){y.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,G(M))},e.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<y?Math.floor(1e3/y):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(y){switch(c){case 1:case 2:case 3:var E=3;break;default:E=c}var x=c;c=E;try{return y()}finally{c=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(y,E){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var x=c;c=y;try{return E()}finally{c=x}},e.unstable_scheduleCallback=function(y,E,x){var O=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?O+x:O):x=O,y){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=x+A,y={id:r++,callback:E,priorityLevel:y,startTime:x,expirationTime:A,sortIndex:-1},x>O?(y.sortIndex=x,t(m,y),n(a)===null&&y===n(m)&&(P?(l(k),k=-1):P=!0,D(_,x-O))):(y.sortIndex=A,t(a,y),p||d||(p=!0,G(M))),y},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(y){var E=c;return function(){var x=c;c=E;try{return y.apply(this,arguments)}finally{c=x}}}})(st);(function(e){e.exports=st})(pn);var Ye,Ze;const mn=(e,...t)=>t.reduce((n,i)=>n==null?void 0:n[i],e),re="ColorManagement"in Le&&mn(Le,"ColorManagement")||null,at=e=>e&&e.isOrthographicCamera,vn=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((Ye=window.document)!=null&&Ye.createElement||((Ze=window.navigator)==null?void 0:Ze.product)==="ReactNative")?g.useLayoutEffect:g.useEffect;function lt(e){const t=g.useRef(e);return me(()=>void(t.current=e),[e]),t}function hn({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ct extends g.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ct.getDerivedStateFromError=()=>({error:!0});const ut="__default",Ke=new Map,gn=e=>e&&!!e.memoized&&!!e.changes;function ft(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e))return e===t;const u=z.obj(e);if(u&&i==="reference")return e===t;const h=z.arr(e);if(h&&n==="reference")return e===t;if((h||u)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;for(v in s?t:e)if(e[v]!==t[v])return!1;if(z.und(v)){if(h&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function yn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function bn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const n=e;return(t!=null&&t.primitive||!n.__r3f)&&(n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Fe(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((u,h)=>u[h],e),{target:n,key:s}}else return{target:n,key:t}}const Je=/-\d+$/;function Se(e,t,n){if(z.str(n)){if(Je.test(n)){const u=n.replace(Je,""),{target:h,key:v}=Fe(e,u);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:s}=Fe(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function Qe(e,t,n){var i,s;if(z.str(n)){const{target:u,key:h}=Fe(e,n),v=t.__r3f.previousAttach;v===void 0?delete u[h]:u[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function dt(e,{children:t,key:n,ref:i,...s},{children:u,key:h,ref:v,...a}={},m=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},c=Object.entries(s),d=[];if(m){const P=Object.keys(a);for(let w=0;w<P.length;w++)s.hasOwnProperty(P[w])||c.unshift([P[w],ut+"remove"])}c.forEach(([P,w])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&P==="object"||z.equ(w,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return d.push([P,w,!0,[]]);let f=[];P.includes("-")&&(f=P.split("-")),d.push([P,w,!1,f]);for(const b in s){const _=s[b];b.startsWith(`${P}-`)&&d.push([b,_,!1,b.split("-")])}});const p={...s};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}function Oe(e,t){var n,i,s;const u=(n=e.__r3f)!=null?n:{},h=u.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:a,changes:m}=gn(t)?t:dt(e,t),r=u.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let c=0;c<m.length;c++){let[d,p,P,w]=m[c],l=e,f=l[d];if(w.length&&(f=w.reduce((b,_)=>b[_],e),!(f&&f.set))){const[b,..._]=w.reverse();l=_.reverse().reduce((M,S)=>M[S],e),d=b}if(p===ut+"remove")if(l.constructor){let b=Ke.get(l.constructor);b||(b=new l.constructor,Ke.set(l.constructor,b)),p=b[d]}else p=0;if(P)p?u.handlers[d]=p:delete u.handlers[d],u.eventCount=Object.keys(u.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Ce)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&f.constructor===p.constructor)f.copy(p);else if(p!==void 0){const b=f instanceof Vt;!b&&f.setScalar?f.setScalar(p):f instanceof Ce&&p instanceof Ce?f.mask=p.mask:f.set(p),!re&&!v.linear&&b&&f.convertSRGBToLinear()}}else l[d]=p,!v.linear&&l[d]instanceof Rt&&l[d].format===kt&&l[d].type===At&&(l[d].encoding=rt);ie(e)}if(u.parent&&v.internal&&e.raycast&&r!==u.eventCount){const c=v.internal.interaction.indexOf(e);c>-1&&v.internal.interaction.splice(c,1),u.eventCount&&v.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(s=e.__r3f)!=null&&s.parent&&ze(e),e}function ie(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function ze(e){e.onUpdate==null||e.onUpdate(e)}function wn(e,t){e.manual||(at(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ye(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function _n(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function pt(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function En(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{pt(n.capturedMap,t,i,s)})}function Pn(e){function t(a){const{internal:m}=e.getState(),r=a.offsetX-m.initialClick[0],o=a.offsetY-m.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(a){return a.filter(m=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=m.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(a,m){const r=e.getState(),o=new Set,c=[],d=m?m(r.internal.interaction):r.internal.interaction;for(let l=0;l<d.length;l++){const f=ce(d[l]);f&&(f.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(a,r);function p(l){const f=ce(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(a,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let P=d.flatMap(p).sort((l,f)=>{const b=ce(l.object),_=ce(f.object);return!b||!_?l.distance-f.distance:_.events.priority-b.events.priority||l.distance-f.distance}).filter(l=>{const f=ye(l);return o.has(f)?!1:(o.add(f),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const l of P){let f=l.object;for(;f;){var w;(w=f.__r3f)!=null&&w.eventCount&&c.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in a&&r.internal.capturedMap.has(a.pointerId))for(let l of r.internal.capturedMap.get(a.pointerId).values())o.has(ye(l.intersection))||c.push(l.intersection);return c}function s(a,m,r,o){const c=e.getState();if(a.length){const d={stopped:!1};for(const p of a){const P=ce(p.object)||c,{raycaster:w,pointer:l,camera:f,internal:b}=P,_=new q(l.x,l.y,0).unproject(f),M=T=>{var j,H;return(j=(H=b.capturedMap.get(T))==null?void 0:H.has(p.eventObject))!=null?j:!1},S=T=>{const j={intersection:p,target:m.target};b.capturedMap.has(T)?b.capturedMap.get(T).set(p.eventObject,j):b.capturedMap.set(T,new Map([[p.eventObject,j]])),m.target.setPointerCapture(T)},R=T=>{const j=b.capturedMap.get(T);j&&pt(b.capturedMap,p.eventObject,j,T)};let k={};for(let T in m){let j=m[T];typeof j!="function"&&(k[T]=j)}let C={...p,...k,pointer:l,intersections:a,stopped:d.stopped,delta:r,unprojectedPoint:_,ray:w.ray,camera:f,stopPropagation(){const T="pointerId"in m&&b.capturedMap.get(m.pointerId);if((!T||T.has(p.eventObject))&&(C.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(j=>j.eventObject===p.eventObject))){const j=a.slice(0,a.indexOf(p));u([...j,p])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:R},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:R},nativeEvent:m};if(o(C),d.stopped===!0)break}}return a}function u(a){const{internal:m}=e.getState();for(const r of m.hovered.values())if(!a.length||!a.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const c=r.eventObject.__r3f,d=c==null?void 0:c.handlers;if(m.hovered.delete(ye(r)),c!=null&&c.eventCount){const p={...r,intersections:a};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function h(a,m){for(let r=0;r<m.length;r++){const o=m[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return m=>{const{internal:r}=e.getState();"pointerId"in m&&r.capturedMap.has(m.pointerId)&&(r.capturedMap.delete(m.pointerId),u([]))}}return function(r){const{onPointerMissed:o,internal:c}=e.getState();c.lastEvent.current=r;const d=a==="onPointerMove",p=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",w=i(r,d?n:void 0),l=p?t(r):0;a==="onPointerDown"&&(c.initialClick=[r.offsetX,r.offsetY],c.initialHits=w.map(b=>b.eventObject)),p&&!w.length&&l<=2&&(h(r,c.interaction),o&&o(r)),d&&u(w);function f(b){const _=b.eventObject,M=_.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(d){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const R=ye(b),k=c.hovered.get(R);k?k.stopped&&b.stopPropagation():(c.hovered.set(R,b),S.onPointerOver==null||S.onPointerOver(b),S.onPointerEnter==null||S.onPointerEnter(b))}S.onPointerMove==null||S.onPointerMove(b)}else{const R=S[a];R?(!p||c.initialHits.includes(_))&&(h(r,c.interaction.filter(k=>!c.initialHits.includes(k))),R(b)):p&&c.initialHits.includes(_)&&h(r,c.interaction.filter(k=>!c.initialHits.includes(k)))}}s(w,r,l,f)}}return{handlePointer:v}}let Ie={},Mn=e=>void(Ie={...Ie,...e});function Cn(e,t){function n(r,{args:o=[],attach:c,...d},p){let P=`${r[0].toUpperCase()}${r.slice(1)}`,w;if(r==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;w=oe(l,{type:r,root:p,attach:c,primitive:!0})}else{const l=Ie[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");w=oe(new l(...o),{type:r,root:p,attach:c,memoizedProps:{args:o}})}return w.__r3f.attach===void 0&&(w instanceof Dt?w.__r3f.attach="geometry":w instanceof Lt&&(w.__r3f.attach="material")),P!=="inject"&&Oe(w,d),w}function i(r,o){let c=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Se(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),c=!0),c||(p=r.__r3f)==null||p.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,ze(o),ie(o)}}function s(r,o,c){let d=!1;if(o){var p,P;if((p=o.__r3f)!=null&&p.attach)Se(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"});const w=r.children.filter(f=>f!==o),l=w.indexOf(c);r.children=[...w.slice(0,l),o,...w.slice(l)],d=!0}d||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,ze(o),ie(o)}}function u(r,o,c=!1){r&&[...r].forEach(d=>h(o,d,c))}function h(r,o,c){if(o){var d,p,P;if(o.__r3f&&(o.__r3f.parent=null),(d=r.__r3f)!=null&&d.objects&&(r.__r3f.objects=r.__r3f.objects.filter(_=>_!==o)),(p=o.__r3f)!=null&&p.attach)Qe(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var w;r.remove(o),(w=o.__r3f)!=null&&w.root&&En(o.__r3f.root,o)}const f=(P=o.__r3f)==null?void 0:P.primitive,b=c===void 0?o.dispose!==null&&!f:c;if(!f){var l;u((l=o.__r3f)==null?void 0:l.objects,o,b),u(o.children,o,b)}o.__r3f&&(delete o.__r3f.root,delete o.__r3f.objects,delete o.__r3f.handlers,delete o.__r3f.memoizedProps,f||delete o.__r3f),b&&o.dispose&&o.type!=="Scene"&&_e.unstable_scheduleCallback(_e.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),ie(r)}}function v(r,o,c,d){var p;const P=(p=r.__r3f)==null?void 0:p.parent;if(!P)return;const w=n(o,c,r.__r3f.root);if(r.children){for(const l of r.children)l.__r3f&&i(w,l);r.children=r.children.filter(l=>!l.__r3f)}r.__r3f.objects.forEach(l=>i(w,l)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||h(P,r),w.parent&&(w.__r3f.autoRemovedBeforeAppend=!0),i(P,w),w.raycast&&w.__r3f.eventCount&&w.__r3f.root.getState().internal.interaction.push(w),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=w,l.ref&&(typeof l.ref=="function"?l.ref(w):l.ref.current=w))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:rn({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const c=r.getState().scene;c.__r3f&&(c.__r3f.root=r,i(c,o))},removeChildFromContainer:(r,o)=>{o&&h(r.getState().scene,o)},insertInContainerBefore:(r,o,c)=>{if(!o||!c)return;const d=r.getState().scene;d.__r3f&&s(d,o,c)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;const c=(o=r==null?void 0:r.__r3f)!=null?o:{};return Boolean(c.handlers)},prepareUpdate(r,o,c,d){if(r.__r3f.primitive&&d.object&&d.object!==r)return[!0];{const{args:p=[],children:P,...w}=d,{args:l=[],children:f,...b}=c;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((M,S)=>M!==l[S]))return[!0];const _=dt(r,w,b,!0);return _.changes.length?[!1,_]:null}},commitUpdate(r,[o,c],d,p,P,w){o?v(r,d,P,w):Oe(r,c)},commitMount(r,o,c,d){var p;const P=(p=r.__r3f)!=null?p:{};r.raycast&&P.handlers&&P.eventCount&&r.__r3f.root.getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>oe(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:c,parent:d}=(o=r.__r3f)!=null?o:{};c&&d&&Qe(d,r,c),r.isObject3D&&(r.visible=!1),ie(r)},unhideInstance(r,o){var c;const{attach:d,parent:p}=(c=r.__r3f)!=null?c:{};d&&p&&Se(p,r,d),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),ie(r)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Oe}}const mt=e=>!!(e!=null&&e.render),vt=g.createContext(null),xn=(e,t)=>{const n=it((v,a)=>{const m=new q,r=new q,o=new q;function c(l=a().camera,f=r,b=a().size){const{width:_,height:M,top:S,left:R}=b,k=_/M;f instanceof q?o.copy(f):o.set(...f);const C=l.getWorldPosition(m).distanceTo(o);if(at(l))return{width:_/l.zoom,height:M/l.zoom,top:S,left:R,factor:1,distance:C,aspect:k};{const T=l.fov*Math.PI/180,j=2*Math.tan(T/2)*C,H=j*(_/M);return{width:H,height:j,top:S,left:R,factor:_/H,distance:C,aspect:k}}}let d;const p=l=>v(f=>({performance:{...f.performance,current:l}})),P=new Ft;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:(l=1)=>e(a(),l),advance:(l,f)=>t(l,f,a()),legacy:!1,linear:!1,flat:!1,scene:oe(new zt),controls:null,clock:new It,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>v(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,b,_,M)=>{const S=a().camera,R={width:l,height:f,top:_||0,left:M||0,updateStyle:b};v(k=>({size:R,viewport:{...k.viewport,...c(S,r,R)}}))},setDpr:l=>v(f=>{const b=ft(l);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:g.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,b)=>{const _=a().internal;return _.priority=_.priority+(f>0?1:0),_.subscribers.push({ref:l,priority:f,store:b}),_.subscribers=_.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=a().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(f>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==l))}}}}}),i=n.getState();let s=i.size,u=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:v,size:a,viewport:m,gl:r,set:o}=n.getState();if(a!==s||m.dpr!==u){var c;s=a,u=m.dpr,wn(v,a),r.setPixelRatio(m.dpr);const d=(c=a.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(a.width,a.height,d)}v!==h&&(h=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),n.subscribe(v=>e(v)),n};let be,Sn=new Set,On=new Set,Tn=new Set;function Te(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ue(e,t){switch(e){case"before":return Te(Sn,t);case"after":return Te(On,t);case"tail":return Te(Tn,t)}}let je,Re;function ke(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),je=t.internal.subscribers,be=0;be<je.length;be++)Re=je[be],Re.ref.current(Re.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function jn(e){let t=!1,n,i,s;function u(a){i=requestAnimationFrame(u),t=!0,n=0,ue("before",a);for(const r of e.values()){var m;s=r.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((m=s.gl.xr)!=null&&m.isPresenting)&&(n+=ke(a,s))}if(ue("after",a),n===0)return ue("tail",a),t=!1,cancelAnimationFrame(i)}function h(a,m=1){var r;if(!a)return e.forEach(o=>h(o.store.getState()),m);(r=a.gl.xr)!=null&&r.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+m),t||(t=!0,requestAnimationFrame(u)))}function v(a,m=!0,r,o){if(m&&ue("before",a),r)ke(a,r,o);else for(const c of e.values())ke(a,c.store.getState());m&&ue("after",a)}return{loop:u,invalidate:h,advance:v}}function ht(){const e=g.useContext(vt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function B(e=n=>n,t){return ht()(e,t)}function Ge(e,t=0){const n=ht(),i=n.getState().internal.subscribe,s=lt(e);return me(()=>i(s,t,n),[t,i,n]),null}function gt(e,t){return function(n,...i){const s=new n;return e&&e(s),Promise.all(i.map(u=>new Promise((h,v)=>s.load(u,a=>{a.scene&&Object.assign(a,yn(a.scene)),h(a)},t,a=>v(new Error(`Could not load ${u}: ${a.message})`))))))}}function K(e,t,n,i){const s=Array.isArray(t)?t:[t],u=un(gt(n,i),[e,...s],{equal:z.equ});return Array.isArray(t)?u:u[0]}K.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return fn(gt(n),[e,...i])};K.clear=function(e,t){const n=Array.isArray(t)?t:[t];return dn([e,...n])};const ae=new Map,{invalidate:et,advance:tt}=jn(ae),{reconciler:Ee,applyProps:Z}=Cn(ae,_n),fe={objects:"shallow",strict:!1},Rn=(e,t)=>{const n=typeof e=="function"?e(t):e;return mt(n)?n:new Ht({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function kn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:i,top:s,left:u}=e.parentElement.getBoundingClientRect();return{width:n,height:i,top:s,left:u}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function An(e){const t=ae.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,u=i||xn(et,tt),h=n||Ee.createContainer(u,se.ConcurrentRoot,null,!1,null,"",s,null);t||ae.set(e,{fiber:h,store:u});let v,a=!1;return{configure(m={}){let{gl:r,size:o,events:c,onCreated:d,shadows:p=!1,linear:P=!1,flat:w=!1,legacy:l=!1,orthographic:f=!1,frameloop:b="always",dpr:_=[1,2],performance:M,raycaster:S,camera:R,onPointerMissed:k}=m,C=u.getState(),T=C.gl;C.gl||C.set({gl:T=Rn(r,e)});let j=C.raycaster;j||C.set({raycaster:j=new jt});const{params:H,...N}=S||{};if(z.equ(N,j,fe)||Z(j,{...N}),z.equ(H,j.params,fe)||Z(j,{params:{...j.params,...H}}),!C.camera){const y=R instanceof Wt,E=y?R:f?new We(0,0,0,0,.1,1e3):new $e(75,0,.1,1e3);y||(E.position.z=5,R&&Z(E,R),R!=null&&R.rotation||E.lookAt(0,0,0)),C.set({camera:E})}if(!C.xr){const y=(O,A)=>{const F=u.getState();F.frameloop!=="never"&&tt(O,!0,F,A)},E=()=>{const O=u.getState();O.gl.xr.enabled=O.gl.xr.isPresenting,O.gl.xr.setAnimationLoop(O.gl.xr.isPresenting?y:null),O.gl.xr.isPresenting||et(O)},x={connect(){const O=u.getState().gl;O.xr.addEventListener("sessionstart",E),O.xr.addEventListener("sessionend",E)},disconnect(){const O=u.getState().gl;O.xr.removeEventListener("sessionstart",E),O.xr.removeEventListener("sessionend",E)}};T.xr&&x.connect(),C.set({xr:x})}if(T.shadowMap){const y=T.shadowMap.enabled,E=T.shadowMap.type;if(T.shadowMap.enabled=!!p,z.boo(p))T.shadowMap.type=Me;else if(z.str(p)){var U;const x={basic:$t,percentage:Bt,soft:Me,variance:Nt};T.shadowMap.type=(U=x[p])!=null?U:Me}else z.obj(p)&&Object.assign(T.shadowMap,p);(y!==T.shadowMap.enabled||E!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}re&&("enabled"in re?re.enabled=!l:"legacyMode"in re&&(re.legacyMode=l));const I=P?Gt:rt,G=w?qt:Ut;T.outputEncoding!==I&&(T.outputEncoding=I),T.toneMapping!==G&&(T.toneMapping=G),C.legacy!==l&&C.set(()=>({legacy:l})),C.linear!==P&&C.set(()=>({linear:P})),C.flat!==w&&C.set(()=>({flat:w})),r&&!z.fun(r)&&!mt(r)&&!z.equ(r,T,fe)&&Z(T,r),c&&!C.events.handlers&&C.set({events:c(u)});const D=kn(e,o);return z.equ(D,C.size,fe)||C.setSize(D.width,D.height,D.updateStyle,D.top,D.left),_&&C.viewport.dpr!==ft(_)&&C.setDpr(_),C.frameloop!==b&&C.setFrameloop(b),C.onPointerMissed||C.set({onPointerMissed:k}),M&&!z.equ(M,C.performance,fe)&&C.set(y=>({performance:{...y.performance,...M}})),v=d,a=!0,this},render(m){return a||this.configure(),Ee.updateContainer(g.createElement(Dn,{store:u,children:m,onCreated:v,rootElement:e}),h,null,()=>{}),u},unmount(){yt(e)}}}function Dn({store:e,children:t,onCreated:n,rootElement:i}){return me(()=>{const s=e.getState();s.set(u=>({internal:{...u.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),g.createElement(vt.Provider,{value:e},t)}function yt(e,t){const n=ae.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),Ee.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var u,h,v,a;s.events.disconnect==null||s.events.disconnect(),(u=s.gl)==null||(h=u.renderLists)==null||h.dispose==null||h.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),bn(s),ae.delete(e),t&&t(e)}catch{}},500)})}}Ee.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:g.version});const Ae={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ln(e){const{handlePointer:t}=Pn(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Ae).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:u}=e.getState();u.disconnect==null||u.disconnect(),s(h=>({events:{...h.events,connected:n}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([h,v])=>{const[a,m]=Ae[h];n.addEventListener(a,v,{passive:m})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([u,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Ae[u];i.connected.removeEventListener(v,h)}}),n(u=>({events:{...u.events,connected:void 0}}))}}}}const Fn=g.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:u,events:h=Ln,eventSource:v,eventPrefix:a,shadows:m,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:P,performance:w,raycaster:l,camera:f,onPointerMissed:b,onCreated:_,...M},S){g.useMemo(()=>Mn(Le),[]);const R=nn(),[k,C]=en({scroll:!0,debounce:{scroll:50,resize:0},...i}),T=g.useRef(null),j=g.useRef(null),[H,N]=g.useState(null);g.useImperativeHandle(S,()=>T.current);const U=lt(b),[I,G]=g.useState(!1),[D,y]=g.useState(!1);if(I)throw I;if(D)throw D;const E=g.useRef(null);C.width>0&&C.height>0&&H&&(E.current||(E.current=An(H)),E.current.configure({gl:u,events:h,shadows:m,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:P,performance:w,raycaster:l,camera:f,size:C,onPointerMissed:(...O)=>U.current==null?void 0:U.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(v?vn(v)?v.current:v:j.current),a&&O.setEvents({compute:(A,F)=>{const W=A[a+"X"],V=A[a+"Y"];F.pointer.set(W/F.size.width*2-1,-(V/F.size.height)*2+1),F.raycaster.setFromCamera(F.pointer,F.camera)}}),_==null||_(O)}}),E.current.render(g.createElement(R,null,g.createElement(ct,{set:y},g.createElement(g.Suspense,{fallback:g.createElement(hn,{set:G})},t))))),me(()=>{N(T.current)},[]),g.useEffect(()=>{if(H)return()=>yt(H)},[H]);const x=v?"none":"auto";return g.createElement("div",pe({ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...s}},M),g.createElement("div",{ref:k,style:{width:"100%",height:"100%"}},g.createElement("canvas",{ref:T,style:{display:"block"}},n)))}),ur=g.forwardRef(function(t,n){return g.createElement(tn,null,g.createElement(Fn,pe({},t,{ref:n})))}),ve=new q,qe=new q,zn=new q;function In(e,t,n){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,u=n.height/2;return[i.x*s+s,-(i.y*u)+u]}function Hn(e,t){const n=ve.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),u=t.getWorldDirection(zn);return s.angleTo(u)>Math.PI/2}function Wn(e,t,n,i){const s=ve.setFromMatrixPosition(e.matrixWorld),u=s.clone();u.project(t),n.setFromCamera(u,t);const h=n.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return s.distanceTo(n.ray.origin)<v}return!0}function $n(e,t){if(t instanceof We)return t.zoom;if(t instanceof $e){const n=ve.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,u=n.distanceTo(i);return 1/(2*Math.tan(s/2)*u)}else return 1}function Bn(e,t,n){if(t instanceof $e||t instanceof We){const i=ve.setFromMatrixPosition(e.matrixWorld),s=qe.setFromMatrixPosition(t.matrixWorld),u=i.distanceTo(s),h=(n[1]-n[0])/(t.far-t.near),v=n[1]-h*t.far;return Math.round(h*u+v)}}const He=e=>Math.abs(e)<1e-10?0:e;function bt(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=He(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Nn=(e=>t=>bt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Gn=(e=>(t,n)=>bt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function qn(e){return e&&typeof e=="object"&&"current"in e}const fr=g.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:u,fullscreen:h,portal:v,distanceFactor:a,sprite:m=!1,transform:r=!1,occlude:o,onOcclude:c,castShadow:d,receiveShadow:p,material:P,geometry:w,zIndexRange:l=[16777271,0],calculatePosition:f=In,as:b="div",wrapperClass:_,pointerEvents:M="auto",...S},R)=>{const{gl:k,camera:C,scene:T,size:j,raycaster:H,events:N,viewport:U}=B(),[I]=g.useState(()=>document.createElement(b)),G=g.useRef(),D=g.useRef(null),y=g.useRef(0),E=g.useRef([0,0]),x=g.useRef(null),O=g.useRef(null),A=(v==null?void 0:v.current)||N.connected||k.domElement.parentNode,F=g.useRef(null),W=g.useRef(!1),V=g.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&qn(o[0]),[o]);g.useLayoutEffect(()=>{const $=k.domElement;o&&o==="blending"?($.style.zIndex=`${Math.floor(l[0]/2)}`,$.style.position="absolute",$.style.pointerEvents="none"):($.style.zIndex=null,$.style.position=null,$.style.pointerEvents=null)},[o]),g.useLayoutEffect(()=>{if(D.current){const $=G.current=on(I);if(T.updateMatrixWorld(),r)I.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const L=f(D.current,C,j);I.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${L[0]}px,${L[1]}px,0);transform-origin:0 0;`}return A&&(s?A.prepend(I):A.appendChild(I)),()=>{A&&A.removeChild(I),$.unmount()}}},[A,r]),g.useLayoutEffect(()=>{_&&(I.className=_)},[_]);const X=g.useMemo(()=>r?{position:"absolute",top:0,left:0,width:j.width,height:j.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...h&&{top:-j.height/2,left:-j.width/2,width:j.width,height:j.height},...n},[n,u,h,j,r]),te=g.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);g.useLayoutEffect(()=>{if(W.current=!1,r){var $;($=G.current)==null||$.render(g.createElement("div",{ref:x,style:X},g.createElement("div",{ref:O,style:te},g.createElement("div",{ref:R,className:i,style:n,children:e}))))}else{var L;(L=G.current)==null||L.render(g.createElement("div",{ref:R,style:X,className:i,children:e}))}});const ne=g.useRef(!0);Ge($=>{if(D.current){C.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const L=r?E.current:f(D.current,C,j);if(r||Math.abs(y.current-C.zoom)>t||Math.abs(E.current[0]-L[0])>t||Math.abs(E.current[1]-L[1])>t){const J=Hn(D.current,C);let Y=!1;V&&(o!=="blending"?Y=[T]:Array.isArray(o)&&(Y=o.map(Q=>Q.current)));const le=ne.current;if(Y){const Q=Wn(D.current,C,H,Y);ne.current=Q&&!J}else ne.current=!J;le!==ne.current&&(c?c(!ne.current):I.style.display=ne.current?"block":"none");const he=Math.floor(l[0]/2),Pt=o?V?[l[0],he]:[he-1,0]:l;if(I.style.zIndex=`${Bn(D.current,C,Pt)}`,r){const[Q,Ve]=[j.width/2,j.height/2],Pe=C.projectionMatrix.elements[5]*Ve,{isOrthographicCamera:Xe,top:Mt,left:Ct,bottom:xt,right:St}=C,Ot=Nn(C.matrixWorldInverse),Tt=Xe?`scale(${Pe})translate(${He(-(St+Ct)/2)}px,${He((Mt+xt)/2)}px)`:`translateZ(${Pe}px)`;let ee=D.current.matrixWorld;m&&(ee=C.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(D.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),I.style.width=j.width+"px",I.style.height=j.height+"px",I.style.perspective=Xe?"":`${Pe}px`,x.current&&O.current&&(x.current.style.transform=`${Tt}${Ot}translate(${Q}px,${Ve}px)`,O.current.style.transform=Gn(ee,1/((a||10)/400)))}else{const Q=a===void 0?1:$n(D.current,C)*a;I.style.transform=`translate3d(${L[0]}px,${L[1]}px,0) scale(${Q})`}E.current=L,y.current=C.zoom}}if(!V&&F.current&&!W.current)if(r){if(x.current){const L=x.current.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const{isOrthographicCamera:J}=C;if(J||w)S.scale&&(Array.isArray(S.scale)?S.scale instanceof q?F.current.scale.copy(S.scale.clone().divideScalar(1)):F.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):F.current.scale.setScalar(1/S.scale));else{const Y=(a||10)/400,le=L.clientWidth*Y,he=L.clientHeight*Y;F.current.scale.set(le,he,1)}W.current=!0}}}else{const L=I.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const J=1/U.factor,Y=L.clientWidth*J,le=L.clientHeight*J;F.current.scale.set(Y,le,1),W.current=!0}F.current.lookAt($.camera.position)}});const Ue=g.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return g.createElement("group",pe({},S,{ref:D}),o&&!V&&g.createElement("mesh",{castShadow:d,receiveShadow:p,ref:F},w||g.createElement("planeGeometry",null),P||g.createElement("shaderMaterial",{side:Xt,vertexShader:Ue.vertexShader,fragmentShader:Ue.fragmentShader})))});let de=0;const dr=it(e=>(ge.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-de)/(i-de)*100})},ge.onLoad=()=>{e({active:!1})},ge.onError=t=>e(n=>({errors:[...n.errors,t]})),ge.onProgress=(t,n,i)=>{n===i&&(de=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),nt=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function wt(e,t){const n=B(s=>s.gl),i=K(Be,nt(e)?Object.values(e):e);if(g.useLayoutEffect(()=>{t==null||t(i)},[t]),g.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(n.initTexture)},[n,i]),nt(e)){const s=Object.keys(e),u={};return s.forEach(h=>Object.assign(u,{[h]:i[s.indexOf(h)]})),u}else return i}wt.preload=e=>K.preload(Be,e);wt.clear=e=>K.clear(Be,e);function Un(e){return Array.isArray(e)}function De(e=[0,0,0]){return Un(e)?e:e instanceof q||e instanceof ot?[e.x,e.y,e.z]:[e,e,e]}function pr({debug:e,mesh:t,children:n,position:i,rotation:s,scale:u,...h}){const v=g.useRef(null),a=g.useRef(null);return g.useLayoutEffect(()=>{const m=(t==null?void 0:t.current)||v.current.parent,r=v.current;if(!(m instanceof Yt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const o={position:new q,rotation:new ot,scale:new q(1,1,1)};if(m){Z(o,{position:i,scale:u});const c=m.matrixWorld.clone();if(m.matrixWorld.identity(),!s||typeof s=="number"){const d=new Zt;d.position.copy(o.position),d.lookAt(m.position),typeof s=="number"&&d.rotateZ(s),Z(o,{rotation:d.rotation})}else Z(o,{rotation:s});return r.geometry=new sn(m,o.position,o.rotation,o.scale),a.current&&Z(a.current,o),m.matrixWorld=c,()=>{r.geometry.dispose()}}},[t,...De(i),...De(u),...De(s)]),g.createElement("mesh",{ref:v},n||g.createElement("meshStandardMaterial",pe({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},h)),e&&g.createElement("mesh",{ref:a},g.createElement("boxGeometry",null),g.createElement("meshNormalMaterial",{wireframe:!0}),g.createElement("axesHelper",null)))}let we=null;function _t(e,t,n){return i=>{n&&n(i),e&&(we||(we=new an),we.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(we)),t&&i.setMeshoptDecoder(typeof xe=="function"?xe():xe)}}function Et(e,t=!0,n=!0,i){return K(Ne,e,_t(t,n,i))}Et.preload=(e,t=!0,n=!0,i)=>K.preload(Ne,e,_t(t,n,i));Et.clear=e=>K.clear(Ne,e);const mr=g.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:s=!0,onChange:u,onStart:h,onEnd:v,...a},m)=>{const r=B(M=>M.invalidate),o=B(M=>M.camera),c=B(M=>M.gl),d=B(M=>M.events),p=B(M=>M.setEvents),P=B(M=>M.set),w=B(M=>M.get),l=B(M=>M.performance),f=t||o,b=i||d.connected||c.domElement,_=g.useMemo(()=>new ln(f),[f]);return Ge(()=>{_.enabled&&_.update()},-1),g.useEffect(()=>(_.connect(b),()=>void _.dispose()),[b,n,_,r]),g.useEffect(()=>{const M=k=>{r(),n&&l.regress(),u&&u(k)},S=k=>{h&&h(k)},R=k=>{v&&v(k)};return _.addEventListener("change",M),_.addEventListener("start",S),_.addEventListener("end",R),()=>{_.removeEventListener("start",S),_.removeEventListener("end",R),_.removeEventListener("change",M)}},[u,h,v,_,r,p]),g.useEffect(()=>{if(e){const M=w().controls;return P({controls:_}),()=>P({controls:M})}},[e,_]),g.createElement("primitive",pe({ref:m,object:_,enableDamping:s},a))}),vr=g.forwardRef(({children:e,speed:t=1,rotationIntensity:n=1,floatIntensity:i=1,floatingRange:s=[-.1,.1],...u},h)=>{const v=g.useRef(null),a=g.useRef(Math.random()*1e4);return Ge(m=>{var r,o;const c=a.current+m.clock.getElapsedTime();v.current.rotation.x=Math.cos(c/4*t)/8*n,v.current.rotation.y=Math.sin(c/4*t)/8*n,v.current.rotation.z=Math.sin(c/4*t)/20*n;let d=Math.sin(c/4*t)/10;d=Kt.mapLinear(d,-.1,.1,(r=s==null?void 0:s[0])!==null&&r!==void 0?r:-.1,(o=s==null?void 0:s[1])!==null&&o!==void 0?o:.1),v.current.position.y=d*i}),g.createElement("group",u,g.createElement("group",{ref:cn([v,h])},e))});function hr({all:e,scene:t,camera:n}){const i=B(({gl:h})=>h),s=B(({camera:h})=>h),u=B(({scene:h})=>h);return g.useLayoutEffect(()=>{const h=[];e&&(t||u).traverse(m=>{m.visible===!1&&(h.push(m),m.visible=!0)}),i.compile(t||u,n||s);const v=new Jt(128);new Qt(.01,1e5,v).update(i,t||u),v.dispose(),h.forEach(m=>m.visible=!1)},[]),null}export{ur as C,pr as D,vr as F,fr as H,mr as O,hr as P,Et as a,wt as b,dr as u};
